---
slug: deploy-simple-util-npm-library
title: ê°„ë‹¨í•œ ìœ í‹¸ í•¨ìˆ˜ NPM ë¼ì´ë¸ŒëŸ¬ë¦¬ ë°°í¬í•´ë³´ê¸° (feat. TypeScript ì§€ì›, ESM ì§€ì›)
description: NPM ë°°í¬ë¥¼ ì²˜ìŒ í•´ë³´ëŠ” ì‚¬ëŒë“¤ì„ ìœ„í•´ì„œ ì°¨ê·¼ì°¨ê·¼ ê°€ì´ë“œë¥¼ ì‘ì„±í•´ë´¤ìŠµë‹ˆë‹¤.
thumbnail: ./cover.png
tags: ["development", "npm"]
createdAt: "2023/03/12"
updatedAt: ""
featured: true
---

## ê°œìš”

ì•½ 1ë…„ ì „ì— í…Œì˜¤ì˜ ìŠ¤í”„ë¦°íŠ¸ 4ê¸°ì— ì°¸ì—¬í•´ì„œ [NPM ë°°í¬ë¥¼ í•˜ê³  í›„ê¸°ë¥¼ ì‘ì„±í•œ ì ](https://velog.io/@junghyeonsu/NPM-%EB%B0%B0%ED%8F%AC-%EC%96%B4%EB%A0%B5%EC%A7%80-%EC%95%8A%EC%95%84%EC%9A%94-with-%ED%85%8C%EC%98%A4-%EA%B5%AC%EA%B8%80-%EC%8A%A4%ED%94%84%EB%A6%B0%ED%8A%B8-4%EA%B8%B0)ì´ ìˆì—ˆëŠ”ë°
1ë…„ì´ ì§€ë‚œ ì§€ê¸ˆ ì¡°ê¸ˆ ë” ë°œì „ëœ ëª¨ìŠµìœ¼ë¡œ NPM ë°°í¬ì— ëŒ€í•´ì„œ ê°€ì´ë“œë¥¼ ì‘ì„±í•´ë³´ë ¤ê³  í•œë‹¤.

ì£¼ì œëŠ” ê°„ë‹¨í•œ ìœ í‹¸ í•¨ìˆ˜ë¥¼ NPM ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ ë°°í¬í•´ë³´ëŠ” ê²ƒì´ê³ ,
í•˜ë‚˜í•˜ë‚˜ ì§ì ‘ ì½”ë“œë¥¼ ì…ë ¥í•´ë³´ë©° ë‚´ê°€ ì‘ì„±í•˜ëŠ” ì½”ë“œê°€ ì–´ë””ì—ì„œ ì–´ë–»ê²Œ ì‚¬ìš©ë˜ëŠ”ì§€ë¥¼ ì•Œì•„ë³´ëŠ” ê²ƒì´ ëª©í‘œì´ë‹¤.
ìš”ì¦˜ì—” ë‹¹ì—°í•˜ê²Œ ìƒê°ë˜ëŠ” TypeScript(ì´í•˜ ts)ì™€ CommonJS(ì´í•˜ cjs), ECMAScript Module(ì´í•˜ esm) ì§€ì›ì„ í¬í•¨í•´ì„œ ë°°í¬í•´ë³´ì.

ì •ë§ NPM ë°°í¬ë¥¼ ì²˜ìŒ í•´ë³´ëŠ” ì‚¬ëŒë“¤ì„ ìœ„í•´ì„œ ì°¨ê·¼ì°¨ê·¼ ê°€ì´ë“œë¥¼ ì‘ì„±í–ˆìœ¼ë‹ˆ
ë”°ë¼í•´ë³´ë©° ë°°í¬ë¥¼ í•´ë³´ë©´ ì–´ëŠ ê³¼ì •ìœ¼ë¡œ ë°°í¬ê°€ ë˜ëŠ”ì§€ ì•Œ ìˆ˜ ìˆê³  ì „ë°˜ì ì¸ ëŠë‚Œì„ ì¡ì„ ìˆ˜ ìˆì„ ê²ƒì´ë‹¤.

## ë¯¸ë¦¬ë³´ê¸°

- [utils library starter (ìœ í‹¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ ê¹ƒí—ˆë¸Œ í…œí”Œë¦¿)](https://github.com/junghyeonsu/utils-library-starter)

## ê°œë°œ í™˜ê²½

- Node.js v18.12.1
- npm v8.19.2
- íŒ¨í‚¤ì§€ ë§¤ë‹ˆì €ëŠ” yarnì„ ì‚¬ìš©í•œë‹¤.
- ë¦¬ì•¡íŠ¸ë¥¼ ê¼­ ì•Œê³  ìˆì§„ ì•Šì•„ë„ ë˜ì§€ë§Œ ì•Œê³  ìˆë‹¤ë©´ ë” ì¢‹ë‹¤.

## ì‚¬ì „ ì¤€ë¹„

### NPM ê³„ì • ìƒì„±

npm ê³„ì •ì´ ì—†ë‹¤ë©´ [npmjs.com](https://www.npmjs.com/) ì—ì„œ ê³„ì •ì„ ìƒì„±í•œë‹¤.

### NPM ë¡œì»¬ ë¡œê·¸ì¸

```bash
$ npm login
$ npm whoami
```

## ì²« ë°°í¬

### í´ë” ìƒì„±

ìì‹ ì˜ ì´ë¦„ìœ¼ë¡œ ëœ í´ë”ë¥¼ ìƒì„±í•œë‹¤.
ë‚˜ëŠ” `junghyeonsu-utils` ë¼ëŠ” í´ë”ë¥¼ ìƒì„±í–ˆë‹¤.

```bash
$ mkdir junghyeonsu-utils
$ cd junghyeonsu-utils
```

### package.json ìƒì„±

```bash
$ yarn init -y
```

```json
{
  "name": "junghyeonsu-utils",
  "version": "0.0.1",
  "main": "index.js",
  "license": "MIT"
}
```

ì¤‘ìš”í•œ ê²ƒë§Œ ì„¤ëª…í•˜ìë©´ `name`ì€ NPMì— ë°°í¬í•  ë•Œ ì‚¬ìš©ë˜ëŠ” ì´ë¦„ì´ë‹¤.
`npm install junghyeonsu-utils` ì´ë ‡ê²Œ ì…ë ¥í•´ì„œ ì„¤ì¹˜ë¥¼ í•  ìˆ˜ ìˆë‹¤.

`version`ì€ ë°°í¬í•  ë•Œ ì‚¬ìš©ë˜ëŠ” ë²„ì „ì´ë‹¤.
[Semantic Versioning ì²´ê³„](https://semver.org/lang/ko/)ë¥¼ ì‚¬ìš©í•œë‹¤.
ê° ìë¦¬ìˆ˜ëŠ” ìˆœì„œëŒ€ë¡œ `major`, `minor`, `patch` ë²„ì „ì„ ì˜ë¯¸í•œë‹¤.
`major`ê°€ 0 ì´ë©´ ì´ˆê¸° ê°œë°œ ë‹¨ê³„ì´ê³ , 1 ì´ìƒì´ë©´ ì•ˆì •í™”ëœ ë²„ì „ìœ¼ë¡œ í†µìƒ ì‚¬ìš©ëœë‹¤.
ìì‹ ì´ ë¼ì´ë¸ŒëŸ¬ë¦¬ ê°œë°œìë¼ë©´ `major` ë²„ì „ì„ 0ìœ¼ë¡œ ìš°ì„  ìœ ì§€í•˜ê³ , ì™„ì „íˆ ì•ˆì •í™”ë˜ë©´ 1ë¡œ ì˜¬ë¦¬ëŠ” ê²ƒì´ ì¢‹ë‹¤.

`main`ì€ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•  ë•Œ ê¸°ë³¸ ì§„ì…ì ì´ë‹¤.
`index.js` íŒŒì¼ì„ ê¸°ë³¸ ì§„ì…ì ìœ¼ë¡œ ì‚¬ìš©í•˜ê² ë‹¤ëŠ” ì˜ë¯¸ì´ë‹¤.

`license`ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ ë¼ì´ì„¼ìŠ¤ë¥¼ ì˜ë¯¸í•œë‹¤.
MIT ë¼ì´ì„¼ìŠ¤ë¥¼ ì‚¬ìš©í•˜ê² ë‹¤ëŠ” ì˜ë¯¸ì¸ë°, [ìì‹ ì´ ì‚¬ìš©í•˜ê³  ì‹¶ì€ ë¼ì´ì„¼ìŠ¤](https://docs.npmjs.com/cli/v9/configuring-npm/package-json#license)ë¥¼ ì„ íƒí•˜ë©´ ëœë‹¤.
ë¼ì´ì„¼ìŠ¤ì— ëŒ€í•œ ë‚´ìš©ì€ ë„ˆë¬´ ë§ì•„ì„œ ì—¬ê¸°ì„œëŠ” ë‹¤ë£¨ì§€ ì•ŠëŠ”ë‹¤.

### module ì‘ì„±

ìš°ì„  cjs í˜•íƒœë¡œ ëª¨ë“ˆì„ ì‘ì„±í•´ë³´ì.
`index.js` íŒŒì¼ì„ ìƒì„±í•˜ê³  ì•„ë˜ì™€ ê°™ì´ ì‘ì„±í•œë‹¤.
ê¸°ë³¸ì ì¸ ì‚¬ì¹™ì—°ì‚°ì„ í•˜ëŠ” ëª¨ë“ˆì´ë‹¤.

```js
function add(a, b) {
  return a + b;
}

function subtract(a, b) {
  return a - b;
}

function multiply(a, b) {
  return a * b;
}

function divide(a, b) {
  return a / b;
}

module.exports = {
  add,
  subtract,
  multiply,
  divide,
};
```

ì‚¬ì‹¤ ì´ë ‡ê²Œ í•˜ë©´ ëì´ë‹¤.
ì´ì œ `npm publish` ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•˜ë©´ NPMì— ë°°í¬ê°€ ëœë‹¤.

```bash
$ npm notice
$ npm notice ğŸ“¦  junghyeonsu-utils@0.0.1
$ npm notice === Tarball Contents ===
$ npm notice 236B index.js
$ npm notice 98B  package.json
$ npm notice === Tarball Details ===
$ npm notice name:          junghyeonsu-utils
$ npm notice version:       0.0.1
$ npm notice filename:      junghyeonsu-utils-0.0.1.tgz
$ npm notice package size:  300 B
$ npm notice unpacked size: 334 B
$ npm notice shasum:        2f01de64d2c4ba507cc8c6a3c94941b5ffb4345b
$ npm notice integrity:     sha512-mmYrdon7QOWPl[...]Wyb6BcQzQ7tkw==
$ npm notice total files:   2
$ npm notice
$ npm notice Publishing to https://registry.npmjs.org/
+ junghyeonsu-utils@0.0.1
```

ë§Œì•½ ì´ë ‡ê²Œ ë–´ë‹¤ë©´ ë°°í¬ê°€ ì„±ê³µí•œ ê²ƒì´ë‹¤.
í•œ ë²ˆ í™•ì¸í•´ë³´ì.
ìƒˆë¡œìš´ `test` ë¼ëŠ” í´ë”ë¥¼ ë§Œë“¤ê³  ê±°ê¸°ì„œ `yarn init -y`ë¡œ í”„ë¡œì íŠ¸ë¥¼ ì„¸íŒ…í•˜ê³ ,
`yarn add junghyeonsu-utils`ë¡œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì„¤ì¹˜í•´ë³´ì.

```bash
$ mkdir test
$ cd test
$ yarn init -y
$ yarn add junghyeonsu-utils
```

```json,7-7
{
  "name": "test",
  "version": "1.0.0",
  "main": "index.js",
  "license": "MIT",
  "dependencies": {
    "junghyeonsu-utils": "^0.0.1"
  }
}
```

ê·¸ë¦¬ê³  `node_modules` í´ë”ë¥¼ í™•ì¸í•´ë³´ì.
`junghyeonsu-utils` í´ë”ê°€ ìƒì„±ë˜ì—ˆê³ , `index.js` íŒŒì¼ì´ ìˆë‹¤.
ì´ íŒŒì¼ì´ ìš°ë¦¬ê°€ ì‘ì„±í•œ `index.js` íŒŒì¼ì´ë‹¤.

![ìš°ë¦¬ê°€ ì‘ì„±í•œ index.jsíŒŒì¼ì´ node_modulesì•ˆì— ì˜ ë“¤ì–´ê°€ìˆë‹¤.](./1.png)

ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ í•œ ë²ˆ ì‚¬ìš©í•´ë³´ì.
`test` í”„ë¡œì íŠ¸ì—ì„œ `index.js` íŒŒì¼ì„ ìƒì„±í•˜ê³  ì•„ë˜ì™€ ê°™ì´ ì‘ì„±í•œë‹¤.

```js
// -> junghyeonsu-utilsì—ì„œ ì •ì˜í•œ í•¨ìˆ˜ë“¤ì„ ê°€ì ¸ì˜¨ë‹¤.
const { add, divide, multiply, subtract } = require("junghyeonsu-utils");

// -> ê°€ì ¸ì˜¨ í•¨ìˆ˜ë“¤ì„ ì‚¬ìš©í•˜ê³  ê²°ê³¼ë¥¼ ì¶œë ¥í•œë‹¤.
console.log(add(1, 2));
console.log(subtract(1, 2));
console.log(multiply(1, 2));
console.log(divide(1, 2));
```

ê·¸ë¦¬ê³  í•œ ë²ˆ ì‹¤í–‰ì‹œì¼œë³´ì.

```bash
$ node index.js
```

![ê²°ê³¼](./2.png)

íìŒ... ì˜ ì‘ë™í•˜ëŠ” ê²ƒ ê°™ë‹¤!
ë²Œì¨ ìš°ë¦¬ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë§Œë“¤ê³  ë°°í¬í•˜ê³  ì‚¬ìš©í•˜ëŠ” ê²ƒê¹Œì§€ ì„±ê³µí–ˆë‹¤.
ì‚¬ì‹¤ ì´ ê³¼ì •ë§Œ ê¸°ì–µí•˜ë©´ ë‚˜ë¨¸ì§€ ë‹¤ë¥¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ë“¤ì„ ì œì‘í•˜ëŠ” ë°©ë²•ì€ í¬ê²Œ ë‹¤ë¥´ì§€ ì•Šë‹¤.
ì¤‘ê°„ ì¤‘ê°„ì— íŒŒì¼ë“¤ì„ ë³€í™˜í•˜ê³ , ë¹Œë“œí•˜ëŠ” ê³¼ì •ë“¤ì´ ì¶”ê°€ë˜ëŠ” ê²ƒ ë¿ì´ë‹¤.

## ES Module ì§€ì›í•˜ê¸°

ì§€ê¸ˆ ìš°ë¦¬ê°€ ì‘ì„±í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” `CommonJS` í˜•íƒœë¡œ ì‘ì„±ë˜ì–´ ìˆë‹¤.
í† ìŠ¤ í…Œí¬ì—ì„œ ì‘ì„±í•œ [CommonJSì™€ ESMì— ëª¨ë‘ ëŒ€ì‘í•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ ê°œë°œí•˜ê¸°: exports field](https://toss.tech/article/commonjs-esm-exports-field) í¬ìŠ¤íŒ…ì—ì„œ
ì¸ìš©ì„ í•œë‹¤ë©´...

- CJSëŠ” require / module.exports ë¥¼ ì‚¬ìš©í•˜ê³ , ESMì€ import / export ë¬¸ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
- CJS module loaderëŠ” ë™ê¸°ì ìœ¼ë¡œ ì‘ë™í•˜ê³ , ESM module loaderëŠ” ë¹„ë™ê¸°ì ìœ¼ë¡œ ì‘ë™í•©ë‹ˆë‹¤.
- ESMì€ Top-level Awaitì„ ì§€ì›í•˜ê¸° ë•Œë¬¸ì— ë¹„ë™ê¸°ì ìœ¼ë¡œ ë™ì‘í•©ë‹ˆë‹¤.
- ë”°ë¼ì„œ ESMì—ì„œ CJSë¥¼ import í•  ìˆ˜ëŠ” ìˆì§€ë§Œ, CJSì—ì„œ ESMì„ require í•  ìˆ˜ëŠ” ì—†ìŠµë‹ˆë‹¤. ì™œëƒí•˜ë©´ CJSëŠ” Top-level Awaitì„ ì§€ì›í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.
- ì´ ì™¸ì—ë„ ë‘ Module Systemì€ ê¸°ë³¸ì ìœ¼ë¡œ ë™ì‘ì´ ë‹¤ë¦…ë‹ˆë‹¤.
- ë”°ë¼ì„œ ë‘ Module Systemì€ ì„œë¡œ í˜¸í™˜ë˜ê¸° ì–´ë µìŠµë‹ˆë‹¤.

ê·¸ë¦¬ê³  ìµœì‹  ë¸Œë¼ìš°ì €ì—ì„œëŠ” ëŒ€ë¶€ë¶„ `esm`ì„ ì§€ì›í•˜ê³ , ëŒ€ë¶€ë¶„ ì½”ë“œë¥¼ ì‘ì„±í•  ë•Œë„ `esm`ì„ ì‚¬ìš©í•œë‹¤.
(`require`, `module.exports`ë¥¼ ì´ìš©í•´ì„œ react ì½”ë“œë¥¼ ì‘ì„±í•œ ì ì´ ìˆëŠ”ê°€ë¥¼ ìƒê°í•´ë³´ë©´ ëœë‹¤.)

ìš°ì„  ì‚¬ìš©í•˜ëŠ” ì¸¡ì—ì„œ `esm`ì„ ì‘ì„±í•´ì„œ ì½”ë“œë¥¼ ì‘ì„±í•´ë³´ì.

```js,2-2
// -> junghyeonsu-utilsì—ì„œ ì •ì˜í•œ í•¨ìˆ˜ë“¤ì„ ê°€ì ¸ì˜¨ë‹¤.
import { add, divide, multiply, subtract } from "junghyeonsu-utils";

// -> ê°€ì ¸ì˜¨ í•¨ìˆ˜ë“¤ì„ ì‚¬ìš©í•˜ê³  ê²°ê³¼ë¥¼ ì¶œë ¥í•œë‹¤.
console.log(add(1, 2));
console.log(subtract(1, 2));
console.log(multiply(1, 2));
console.log(divide(1, 2));
```

ê·¸ë¦¬ê³  ë˜‘ê°™ì´ ì‹¤í–‰ì„ ì‹œì¼œë³´ì.
ê·¸ëŸ¼ ë‹¤ìŒê³¼ ê°™ì€ ì—ëŸ¬ê°€ ëœ° ê²ƒì´ë‹¤.

```bash
$ node index.js

$ (node:63686) Warning: To load an ES module, set "type": "module" in the package.json or use the .mjs extension.
$ (Use `node --trace-warnings ...` to show where the warning was created)
$ /Users/jeonghyeonsu/Documents/GitHub/test/index.js:2
$ import { add, divide, multiply, subtract } from "junghyeonsu-utils";
$ ^^^^^^
$
$ SyntaxError: Cannot use import statement outside a module
```

`esm`ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” `package.json`ì— `"type": "module"`ì„ ì¶”ê°€í•´ì•¼ í•œë‹¤.

```json,4-4
{
  "name": "test",
  "version": "1.0.0",
  "type": "module",
  "main": "index.js",
  "author": "junghyeonsu <jung660317@naver.com>",
  "license": "MIT",
  "dependencies": {
    "junghyeonsu-utils": "0.0.1"
  }
}
```

ê·¸ë¦¬ê³  ë‹¤ì‹œ ì‹¤í–‰ì‹œì¼œë³´ì.

```bash
$ node index.js
```

![ê²°ê³¼](./5.png)

ë‹¤í–‰íˆ ì˜ ë˜ëŠ” ê²ƒ ê°™ë‹¤!
ê·¸ëŸ¬ë©´ ì´ì œ ìš°ë¦¬ê°€ ë§Œë“  ë¼ì´ë¸ŒëŸ¬ë¦¬ë„ `esm`ì„ ì§€ì›í•˜ë„ë¡ ë§Œë“¤ì–´ë³´ì.
`module.exports` ë¥¼ `export` ë¬¸ìœ¼ë¡œ ë°”ê¿”ì£¼ì.

```js,18-18
function add(a, b) {
  return a + b;
}

function subtract(a, b) {
  return a - b;
}

function multiply(a, b) {
  return a * b;
}

function divide(a, b) {
  return a / b;
}

export { add, subtract, multiply, divide };
```

ê·¸ë¦¬ê³  `package.json`ì— `"type": "module"`ì„ ì¶”ê°€í•´ì£¼ì.
`type` í•„ë“œëŠ” `commonjs`, `module` ì´ë ‡ê²Œ ë‘ ê°œì˜ ì˜µì…˜ì´ ìˆê³ ,
`commonjs`ëŠ” `require`ë¥¼ ì‚¬ìš©í•˜ëŠ” cjs, `module`ì€ `import`ë¥¼ ì‚¬ìš©í•˜ëŠ” esmì´ë‹¤.

```json,4-4
{
  "name": "junghyeonsu-utils",
  "version": "0.0.1",
  "type": "module",
  "main": "index.js",
  "license": "MIT"
}
```

ê·¸ë¦¬ê³  `patch` ë²„ì „ì„ ì˜¬ë ¤ì£¼ê³  ë‹¤ì‹œ ë°°í¬ë¥¼ í•´ë³´ì.

```bash
$ npm version patch
$ npm publish
```

```bash
$ npm notice
$ npm notice ğŸ“¦  junghyeonsu-utils@0.0.2
$ npm notice === Tarball Contents ===
$ npm notice 226B index.js
$ npm notice 98B  package.json
$ npm notice === Tarball Details ===
$ npm notice name:          junghyeonsu-utils
$ npm notice version:       0.0.2
$ npm notice filename:      junghyeonsu-utils-0.0.2.tgz
$ npm notice package size:  293 B
$ npm notice unpacked size: 324 B
$ npm notice shasum:        89aa2f7243c9603c1ed916e4e184b8164bc04277
$ npm notice integrity:     sha512-xXufGijD9quRe[...]v6AfdzfOsO3NA==
$ npm notice total files:   2
$ npm notice
$ npm notice Publishing to https://registry.npmjs.org/
$ + junghyeonsu-utils@0.0.2
```

ì„±ê³µì ìœ¼ë¡œ ë°°í¬ê°€ ëë‹¤ë©´ ë‹¤ì‹œ `test` í”„ë¡œì íŠ¸ë¡œ ì™€ì„œ ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ ë²„ì „ì„ ì˜¬ë¦¬ê³  ì‹¤í–‰ì„ í•´ë³´ì.
ìƒˆë¡œ ë°°í¬ëœ ë²„ì „ì„ ì„¤ì¹˜í•˜ë ¤ë©´ `@0.0.2`ë¥¼ ë¶™ì—¬ì£¼ì–´ì„œ ëª…ì‹œì ìœ¼ë¡œ ë²„ì „ì„ ì§€ì •í•´ì£¼ì–´ì•¼ í• ìˆ˜ë„ ìˆê³ ,
ê·¸ëƒ¥ `@latest`ë¥¼ ë¶™ì—¬ì£¼ì–´ì„œ ìµœì‹  ë²„ì „ì„ ì„¤ì¹˜í•  ìˆ˜ë„ ìˆë‹¤. í˜¹ì€ ì•„ë¬´ê²ƒë„ ë¶™ì´ì§€ ì•Šì•„ë„ ëœë‹¤.

```bash
$ yarn add junghyeonsu-utils
$ npm install junghyeonsu-utils
```

or

```bash
$ yarn add junghyeonsu-utils@0.0.2
$ npm install junghyeonsu-utils@0.0.2
```

```bash
$ node index.js
```

ì•„ë§ˆ ì˜ ë  ê²ƒì´ë‹¤.

![ê²°ê³¼](./5.png)

ê·¼ë° í•­ìƒ ì´ë ‡ê²Œ `esm`ë§Œì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì€ ì•„ë‹ˆë‹¤.
`cjs`ë¥¼ ì‚¬ìš©í•˜ëŠ” í”„ë¡œì íŠ¸ì™€ `esm`ì„ ì‚¬ìš©í•˜ëŠ” í”„ë¡œì íŠ¸ê°€ ê°™ì´ ì¡´ì¬í•  ìˆ˜ë„ ìˆë‹¤.
`cjs`ëŠ” ë³´í†µ server-side renderingì„ ì§€ì›í•  ë•Œ ì‚¬ìš©ë˜ê¸°ë„ í•˜ëŠ”ë°,
`cjs`ëŠ” tree-shaking(íŠ¸ë¦¬ ì‰ì´í‚¹: Tree-shakingì´ë€ í•„ìš”í•˜ì§€ ì•Šì€ ì½”ë“œì™€ ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” ì½”ë“œë¥¼ ì‚­ì œí•˜ì—¬ JavaScript ë²ˆë“¤ì˜ í¬ê¸°ë¥¼ ê°€ë³ê²Œ ë§Œë“œëŠ” ê²ƒ)ì´ ì–´ë ¤ì›Œì„œ,
`esm`ì„ ë™ì‹œ ì§€ì›í•´ì•¼ í•˜ëŠ” ê²½ìš°ê°€ ë‹¤ë°˜ì‚¬ë¼ê³  í•œë‹¤. (ì¶œì²˜ í† ìŠ¤ í…Œí¬)

ê·¸ëŸ¼ ì´ì™€ ê°™ì€ ìƒí™©ì—ì„œ `test` í”„ë¡œì íŠ¸ê°€ `commonjs`ë¥¼ ì‚¬ìš©í•´ì•¼ í•œë‹¤ê³  ê°€ì •í•´ë³´ì.
ê·¸ëŸ¬ë©´ `package.json`ì— `"type": "module"`ì„ `type: "commonjs"`ë¡œ ë°”ê¾¸ê³  ë‹¤ì‹œ ì‹¤í–‰ì‹œì¼œë³´ì.
(defaultê°€ `commonjs`ë¼ì„œ ê·¸ëƒ¥ ì§€ì›Œë„ ëœë‹¤.)

```json,,4-4
{
  "name": "test",
  "version": "1.0.0",
  "type": "commonjs",
  "main": "index.js",
  "author": "junghyeonsu <jung660317@naver.com>",
  "license": "MIT",
  "dependencies": {
    "junghyeonsu-utils": "0.0.2"
  }
}
```

ê·¸ëŸ¬ë©´ ìš°ë¦¬ê°€ ìì£¼ ë§ˆì£¼ì¹œ ì—ëŸ¬ë¥¼ ë§ˆì£¼í•˜ê²Œ ëœë‹¤.

```bash
$ (node:69037) Warning: To load an ES module, set "type": "module" in the package.json or use the .mjs extension.
$ (Use `node --trace-warnings ...` to show where the warning was created)
$ /Users/jeonghyeonsu/Documents/GitHub/test/index.js:2
$ import { add, divide, multiply, subtract } from "junghyeonsu-utils";
$ ^^^^^^
$
$ SyntaxError: Cannot use import statement outside a module
```

ìœ„ì—ì„œ ì„¤ëª…í–ˆë‹¤ì‹œí”¼ `esm` í™˜ê²½ì—ì„œ `cjs`ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì€ ê´œì°®ë‹¤.
í•˜ì§€ë§Œ ê·¸ ë°˜ëŒ€ë¡œ `cjs` í™˜ê²½ì—ì„œ `esm`ì„ ì‚¬ìš©í•˜ë ¤ê³  í•˜ë©´ ì—ëŸ¬ê°€ ë°œìƒí•œë‹¤.

ë¼ì´ë¸ŒëŸ¬ë¦¬ ì œê³µìê°€ ì¼ì¼ì´ `cjs`ì™€ `esm`ì„ ëª¨ë‘ ì§€ì›í•´ì£¼ì§€ ì•ŠëŠ”ë‹¤ë©´,
`cjs`ë¥¼ ì‚¬ìš©í•˜ëŠ” í”„ë¡œì íŠ¸ì—ì„œëŠ” `esm`ì„ ì‚¬ìš©í•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤.
ê·¸ë ‡ë‹¤ë©´ `cjs`ì™€ `esm`ì„ ì–´ë–»ê²Œ í•˜ë©´ ë™ì‹œì— ì§€ì›í•  ìˆ˜ ìˆì„ê¹Œ?

### package.jsonì˜ exports í•„ë“œ ëª…ì‹œí•˜ê¸°

`exports` í•„ë“œëŠ” [node v19.7.0 ë²„ì „ì— ì¶”ê°€ëœ í•„ë“œë¡œ](https://nodejs.org/api/packages.html), `cjs`ì™€ `esm`ì„ ë™ì‹œì— ì§€ì›í•  ìˆ˜ ìˆê²Œ í•´ì¤€ë‹¤.
`exports` ë¼ì´ë¸ŒëŸ¬ë¦¬ ì œê³µìê°€ ì…ë ¥í•´ì£¼ëŠ” ì •ë³´ë¡œ, ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš©ìê°€ ì…ë ¥í•˜ëŠ” ì •ë³´ëŠ” ì•„ë‹ˆë‹¤.

`junghyeonsu-utils`ì˜ `package.json`ì— `exports` ë„£ì–´ë³´ì.

```json,6-11
{
  "name": "junghyeonsu-utils",
  "version": "0.0.2",
  "type": "module",
  "main": "index.js",
  "exports": {
    ".": {
      "import": "./index.js",
      "require": "./index.cjs"
    }
  },
  "license": "MIT"
}
```

`exports` í•„ë“œëŠ” ëª¨ë‘ . ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” ìƒëŒ€ ê²½ë¡œë¡œ ì‘ì„±ë˜ì–´ì•¼ í•œë‹¤.
ë§Œì•½ ë§¨ ì²« ë²ˆì§¸ `.`ì„ `./util`ë¡œ ë°”ê¾¸ë©´ ë‹¤ìŒê³¼ ê°™ì´ ì‚¬ìš©ëœë‹¤.

```js
import { add, divide, multiply, subtract } from "junghyeonsu-utils/util"; // esm
const { add, divide, multiply, subtract } = require("junghyeonsu-utils/util"); // cjs
```

í•˜ì§€ë§Œ ì§€ê¸ˆì€ ìƒëŒ€ê²½ë¡œë¥¼ `.` ìœ¼ë¡œ ì‘ì„±í–ˆê¸° ë•Œë¬¸ì— `exports` í•„ë“œëŠ” `junghyeonsu-utils`ì˜ ë£¨íŠ¸ í´ë”ë¥¼ ë°”ë¼ë³´ê²Œ ëœë‹¤.

```js
import { add, divide, multiply, subtract } from "junghyeonsu-utils"; // esm
const { add, divide, multiply, subtract } = require("junghyeonsu-utils"); // cjs
```

`exports` í•„ë“œì—ì„œ `import`ëŠ” `esm` í™˜ê²½ì—ì„œ ì‚¬ìš©ë˜ê³ , `require`ëŠ” `cjs` í™˜ê²½ì—ì„œ ì‚¬ìš©ëœë‹¤.
í˜„ì¬ `junghyeonsu-utils`ëŠ” `esm`ì„ ì§€ì›í•˜ê³  ìˆê¸° ë•Œë¬¸ì— ê·¸ëƒ¥ `import`ë¥¼ í•˜ê²Œë˜ë©´ `esm` íŒŒì¼ì¸ `index.js` íŒŒì¼ì„ ì‚¬ìš©í•  ê²ƒì´ë‹¤.
í•˜ì§€ë§Œ `cjs` í™˜ê²½ì—ì„œëŠ” `require`ë¥¼ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— `require`ë¥¼ í‚¤ë¡œ ê°€ì§€ëŠ” ê°ì²´ ì•ˆì— `index.cjs` íŒŒì¼ì„ ë°”ë¼ë³´ê²Œ í•œë‹¤.

ê·¸ë¦¬ê³  `commonjs`ë¥¼ ì‚¬ìš©í•˜ëŠ” `index.cjs`ë¥¼ ì‘ì„±í•´ë³´ì.
í”„ë¡œê·¸ë¨ íŒŒì¼ì´ ë§ì•„ì§€ë‹ˆ ì†ŒìŠ¤íŒŒì¼ì„ `src` í´ë”ë¥¼ ë§Œë“¤ì–´ ê·¸ ì•ˆì— ë„£ì–´ì£¼ì.
ê·¸ë¦¬ê³  ê·¸ì— ë§ê²Œ `package.json`ì˜ íŒŒì¼ë„ ìˆ˜ì •í•´ì£¼ì.
ê·¸ë¦¬ê³  ìš°ë¦¬ `junghyeonsu-utils` í´ë” êµ¬ì¡°ëŠ” ì´ë ‡ê²Œ ë  ê²ƒì´ë‹¤.

```js
// src/index.cjs
function add(a, b) {
  return a + b;
}

function subtract(a, b) {
  return a - b;
}

function multiply(a, b) {
  return a * b;
}

function divide(a, b) {
  return a / b;
}

module.exports = {
  add,
  subtract,
  multiply,
  divide,
};
```

```json,5-5&8-9
{
  "name": "junghyeonsu-utils",
  "version": "0.0.2",
  "type": "module",
  "main": "src/index.js",
  "exports": {
    ".": {
      "import": "./src/index.js",
      "require": "./src/index.cjs"
    }
  },
  "license": "MIT"
}
```

```bash
ğŸ“¦junghyeonsu-utils
 â”£ ğŸ“‚src
 â”ƒ â”£ ğŸ“œindex.cjs
 â”ƒ â”— ğŸ“œindex.js
 â”£ ğŸ“œpackage.json
 â”— ğŸ“œyarn.lock
```

ê·¸ë¦¬ê³  `patch`ë¥¼ ì˜¬ë¦¬ê³  `npm`ì— ë°°í¬í•´ë³´ì.
ê·¸ëŸ¼ `0.0.3` ë²„ì „ì´ ë°°í¬ë  ê²ƒì´ë‹¤.

```bash
$ npm version patch
$ npm publish
```

ê·¸ëŸ¼ ë‹¤ì‹œ `test` í”„ë¡œì íŠ¸ì—ì„œ `junghyeonsu-utils@0.0.3`ë¥¼ ì„¤ì¹˜í•˜ê³ ,
ë‹¤ì‹œ ì‹¤í–‰ì„ í•´ë³´ì. ê·¸ëŸ¼ ì•„ê¹Œì „ì—ëŠ” ì—ëŸ¬ê°€ ë‚˜ë˜ ë¶€ë¶„ì´ ì˜ ì‹¤í–‰ë  ê²ƒì´ë‹¤.

```bash
$ yarn add junghyeonsu-utils@0.0.3

$ node index.js
$ 3
$ -1
$ 2
$ 0.5
```

ì´ë ‡ê²Œ í•´ì„œ `cjs`ì™€ `esm`ì„ ë™ì‹œì— ì§€ì›í•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë§Œë“¤ì—ˆë‹¤.

## TypeScript ì§€ì›í•˜ê¸°

íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ëŠ” ì´ì œ ëŒ€ë¶€ë¶„ì˜ í˜„ì§ ê°œë°œìë“¤ì´ ì‚¬ìš©í•˜ê³  ìˆë‹¤.
ë§ì€ ë¦¬ì•¡íŠ¸ ê°œë°œìë“¤ì´ í”„ë¡œì íŠ¸ ì„¸íŒ…í•  ë•Œ ìì£¼ ì‚¬ìš©í•˜ëŠ” `vite`ìœ¼ë¡œ ë¦¬ì•¡íŠ¸ íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ í…œí”Œë¦¿ì„ ìƒì„±í•  ìˆ˜ ìˆë‹¤.
í•œ ë²ˆ ìƒì„±í•´ë³´ê³  ìš°ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì„¤ì¹˜í•´ë³´ì.

ê¸°ì¡´ì˜ `test` í”„ë¡œì íŠ¸ì•ˆì˜ íŒŒì¼ë“¤ì„ ì „ë¶€ ì§€ìš°ê³  `vite` ë¦¬ì•¡íŠ¸ í”„ë¡œì íŠ¸ë¡œ ëŒ€ì²´í•´ë³´ì.

```bash
$ rm -rf *
$ yarn create vite . --template react-ts
```

```bash
yarn create v1.22.19
$ [1/4] ğŸ”  Resolving packages...
$ [2/4] ğŸšš  Fetching packages...
$ [3/4] ğŸ”—  Linking dependencies...
$ [4/4] ğŸ”¨  Building fresh packages...
$ success Installed "create-vite@4.1.0" with binaries:
$       - create-vite
$       - cva
$ [#############################################################################] 77/77
$ Scaffolding project in /Users/jeonghyeonsu/Documents/GitHub/test...
$
$ Done. Now run:
$
$   yarn
$   yarn dev
$
$ âœ¨  Done in 0.83s.
```

ì •ìƒì ìœ¼ë¡œ ì„¤ì¹˜ê°€ ë˜ì—ˆë‹¤ë©´ í”„ë¡œì íŠ¸ì˜ ì˜ì¡´ì„±ì„ ì„¤ì¹˜í•˜ê³  ìš°ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ë„ í•œ ë²ˆ ì„¤ì¹˜í•´ë³´ì.

```bash
$ yarn
$ yarn add junghyeonsu-utils
```

ê·¸ë¦¬ê³  `src/App.tsx` ì—ì„œ ìš°ë¦¬ê°€ ë§Œë“  ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ë ¤ê³  í•´ë³´ì.
(ì§€ê¸ˆì€ ë‹¨ìˆœ ë”í•˜ê¸°, ë¹¼ê¸° ë“±ì˜ ì—°ì‚°ë§Œ ê°€ëŠ¥í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ì§€ë§Œ ë” ë§ì€ ê¸°ëŠ¥ë“¤ì´ ìˆë‹¤ê³  ìƒìƒí•´ë³´ì.)
ì•„ë§ˆ ì—ëŸ¬ê°€ ë‚  ê²ƒì´ë‹¤.

```tsx,,4-4
import React from 'react';
import logo from './logo.svg';
import './App.css';
import { add } from 'junghyeonsu-utils';

function App() {
  return (
    <div className="App">
      <header className="App-header">
        <img src={logo} className="App-logo" alt="logo" />
        <p>
          Edit <code>src/App.tsx</code> and save to reload.
        </p>
        <a
          className="App-link"
          href="https://reactjs.org"
          target="_blank"
          rel="noopener noreferrer"
        >
          Learn React
        </a>
      </header>
    </div>
  );
}

export default App;
```

![ì •ë§ ë§ì€ ê°œë°œìë“¤ì´ ë§Œë‚˜ëŠ” ì—ëŸ¬](./3.png)

ì´ ì—ëŸ¬ëŠ” `junghyeonsu-utils` ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ ì§€ì›ì„ í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ë°œìƒí•˜ëŠ” ì—ëŸ¬ë‹¤.
ìš”ì¦˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ë“¤ì€ ì›¬ë§Œí•˜ë©´ íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ ì§€ì›ì„ ì˜ í•´ì£¼ì§€ë§Œ ì˜›ë‚  ë¼ì´ë¸ŒëŸ¬ë¦¬ ê°™ì€ ê²½ìš°ì—ëŠ” íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì§€ì›í•˜ì§€ ì•ŠëŠ” ê²½ìš°ê°€ ë§ë‹¤.
ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ `@types` íŒ¨í‚¤ì§€ë¥¼ ì§€ì›í•´ì¤€ë‹¤ë©´ í•´ë‹¹ íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•´ì„œ íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì§€ì›í•  ìˆ˜ ìˆê³ ,
ë§Œì•½ `@types` íŒ¨í‚¤ì§€ë„ ì§€ì›ì„ í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ ì‚¬ìš©í•˜ëŠ” ì¸¡ì—ì„œ `d.ts` íŒŒì¼ì„ ì§ì ‘ ë§Œë“¤ì–´ì„œ íƒ€ì…ì„ ì •ì˜í•´ì¤˜ì•¼ í•œë‹¤.

í•˜ì§€ë§Œ ìš°ë¦¬ëŠ” ìœ ì €ë¥¼ ë§Œì¡±ì‹œì¼œì•¼ í•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ ì œê³µìë¡œì„œ íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì§€ì›í•´ë³´ì.

### íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ ì„¤ì •

íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì§€ì›í•˜ê¸° ìœ„í•´ì„œëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ `package.json`ì— `types` í•„ë“œì— `d.ts` íŒŒì¼ì˜ ê²½ë¡œë¥¼ ì§€ì •í•´ì£¼ë©´ ëœë‹¤.
ê·¸ ì „ì— `d.ts` íŒŒì¼ì„ ë½‘ì•„ë‚´ê¸° ìœ„í•´ì„œëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ ì½”ë“œ ìì²´ì—ì„œ íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ ì„¤ì •ì„ í•´ë³´ì.

ë‹¤ì‹œ `junghyeonsu-utils` í”„ë¡œì íŠ¸ë¡œ ëŒì•„ì™€ì„œ íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì„¤ì¹˜í•´ì¤€ë‹¤.
íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ëŠ” ë¹Œë“œ ê²°ê³¼ë¬¼ì—ëŠ” ì˜í–¥ì„ ì£¼ì§€ ì•Šê¸° ë•Œë¬¸ì— `devDependencies`ì— ì„¤ì¹˜í•´ì¤€ë‹¤.
`@types/node`ëŠ” `node`ì˜ íƒ€ì…ì„ ì§€ì›í•´ì£¼ëŠ” íŒ¨í‚¤ì§€ë¡œ ê°™ì´ ì„¤ì¹˜í•´ì£¼ì.

```bash
$ yarn add typescript @types/node -D
```

ê·¸ë¦¬ê³  `tsconfig.json` íŒŒì¼ì„ ìƒì„±í•´ì¤€ë‹¤.

```json
{
  "compilerOptions": {
    "target": "es6" /* ìµœì‹  ë¸Œë¼ìš°ì €ëŠ” es6ì„ ëŒ€ë¶€ë¶„ ì§€ì›í•œë‹¤. */,
    "module": "commonjs" /* ëª¨ë“ˆ ì‹œìŠ¤í…œì„ ì§€ì •í•œë‹¤. */,
    "lib": [
      "es5",
      "es6",
      "dom"
    ] /* íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ê°€ ì–´ë–¤ ë²„ì „ì˜ JSì˜ ë¹ŒíŠ¸ì¸ apië¥¼ ì‚¬ìš©í• ê±´ì§€ì— ëŒ€í•œ ê²ƒì„ ëª…ì‹œí•´ì¤€ë‹¤. */,
    "declaration": true /* íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ê°€ ìë™ìœ¼ë¡œ íƒ€ì…ì •ì˜ (d.ts) íŒŒì¼ì„ ìƒì„±í•´ì¤€ë‹¤. */,
    "outDir": "dist" /* ì»´íŒŒì¼ëœ ê²°ê³¼ë¬¼ì„ ì–´ë””ì— ì €ì¥í• ì§€ì— ëŒ€í•œ ê²ƒì„ ëª…ì‹œí•´ì¤€ë‹¤. */,
    "strict": true /* íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ì˜ ì—„ê²©í•œ ëª¨ë“œë¥¼ í™œì„±í™”í•œë‹¤. */
  }
}
```

ìš”ê¸°ì„œ ì¤‘ìš”í•œ ê²ƒì€ `declaration`ê³¼ `outDir`ì´ë‹¤.
`declaration`ì€ íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ê°€ ìë™ìœ¼ë¡œ íƒ€ì…ì •ì˜ (d.ts) íŒŒì¼ì„ ìƒì„±í•´ì¤€ë‹¤ëŠ” ê²ƒì´ê³ ,
`outDir`ì€ ì»´íŒŒì¼ëœ ê²°ê³¼ë¬¼ì„ ì–´ë””ì— ì €ì¥í• ì§€ì— ëŒ€í•œ ê²ƒì„ ëª…ì‹œí•´ì¤€ë‹¤.
íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ëŠ” í•´ë‹¹ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì§€ì›í•´ì£¼ëŠ”ì§€ í•˜ì§€ ì•ŠëŠ”ì§€ë¥¼ íƒ€ì…ì •ì˜(`d.ts`) íŒŒì¼ì„ ì°¾ì•„ì„œ ê²°ì •í•˜ê¸° ë•Œë¬¸ì— `declaration`ì„ `true`ë¡œ ì„¤ì •í•´ì¤€ë‹¤.

ê¸°ì¡´ì˜ `src/index.js` íŒŒì¼ì˜ ë‚´ìš©ì„ `src/index.ts` íŒŒì¼ë¡œ ë°”ê¿”ì£¼ê³ ,
íƒ€ì… ì—ëŸ¬ê°€ ë°œìƒí•˜ëŠ” ë¶€ë¶„ì„ ëª¨ë‘ ìˆ˜ì •í•´ì£¼ì.

```typescript,2-2&6-6&10-10&14-14
// src/index.ts
function add(a: number, b: number) {
  return a + b;
}

function subtract(a: number, b: number) {
  return a - b;
}

function multiply(a: number, b: number) {
  return a * b;
}

function divide(a: number, b: number) {
  return a / b;
}

module.exports = {
  add,
  subtract,
  multiply,
  divide,
};
```

ê·¸ë¦¬ê³  `tsconfig.json`ì— `include` í•„ë“œë¥¼ ì¶”ê°€í•´ì¤€ë‹¤.

```json,10-10
{
  "compilerOptions": {
    "target": "es6" /* ìµœì‹  ë¸Œë¼ìš°ì €ëŠ” es6ì„ ëŒ€ë¶€ë¶„ ì§€ì›í•œë‹¤. */,
    "module": "ES6" /* ëª¨ë“ˆ ì‹œìŠ¤í…œì„ ì§€ì •í•œë‹¤. */,
    "lib": ["es5", "es6", "dom"] /* íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ê°€ ì–´ë–¤ ë²„ì „ì˜ JSì˜ ë¹ŒíŠ¸ì¸ apië¥¼ ì‚¬ìš©í• ê±´ì§€ì— ëŒ€í•œ ê²ƒì„ ëª…ì‹œí•´ì¤€ë‹¤. */,
    "declaration": true /* íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ê°€ ìë™ìœ¼ë¡œ íƒ€ì…ì •ì˜ (d.ts) íŒŒì¼ì„ ìƒì„±í•´ì¤€ë‹¤. */,
    "outDir": "dist" /* ì»´íŒŒì¼ëœ ê²°ê³¼ë¬¼ì„ ì–´ë””ì— ì €ì¥í• ì§€ì— ëŒ€í•œ ê²ƒì„ ëª…ì‹œí•´ì¤€ë‹¤. */,
    "strict": true /* íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ì˜ ì—„ê²©í•œ ëª¨ë“œë¥¼ í™œì„±í™”í•œë‹¤. */
  },
  "include": ["src/index.ts"] /* ì»´íŒŒì¼í•  ëŒ€ìƒì„ ëª…ì‹œí•´ì¤€ë‹¤. */
}
```

ê·¸ë¦¬ê³  í„°ë¯¸ë„ì—ì„œ `yarn tsc`ë¡œ ì»´íŒŒì¼ì„ í•´ë„ ë˜ì§€ë§Œ, ìš°ë¦¬ëŠ” `package.json`ì— `build script`ë¥¼ ì‘ì„±í•´ë³´ì.

```json,6-9
{
  "name": "junghyeonsu-utils",
  "version": "0.0.3",
  "type": "module",
  "main": "src/index.js",
  "scripts": {
    "build": "yarn build:tsc",
    "build:tsc": "yarn tsc"
  },
  "exports": {
    ".": {
      "import": "./src/index.js",
      "require": "./src/index.cjs"
    }
  },
  "license": "MIT",
  "devDependencies": {
    "@types/node": "^18.15.0",
    "typescript": "^4.9.5"
  }
}
```

ê·¸ë¦¬ê³  `yarn build`ë¥¼ ì‹¤í–‰í•´ë³´ì.
ê·¸ëŸ¼ `tsconfig.json`ì— ëª…ì‹œí•´ì¤€ `outDir`ì— `dist` í´ë”ê°€ ìƒì„±ë˜ê³ , `dist` í´ë” ì•ˆì— `index.js`ì™€ `index.d.ts` íŒŒì¼ì´ ìƒì„±ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
ìƒì„±ëœ íŒŒì¼ë“¤ì„ ê°€ë³ê²Œ ì‚´í´ë³´ë©´ `index.js`ëŠ” íƒ€ì…ì´ ë¹ ì§„ ì½”ë“œê°€ ìƒì„±ë˜ì—ˆê³ , `index.d.ts`ëŠ” íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ê°€ ìë™ìœ¼ë¡œ ìƒì„±í•´ì¤€ íƒ€ì…ì •ì˜ íŒŒì¼ì´ë‹¤.

```js
// dist/index.js
function add(a, b) {
  return a + b;
}
function subtract(a, b) {
  return a - b;
}
function multiply(a, b) {
  return a * b;
}
function divide(a, b) {
  return a / b;
}
export { add, subtract, multiply, divide };
```

```ts
// dist/index.d.ts
declare function add(a: number, b: number): number;
declare function subtract(a: number, b: number): number;
declare function multiply(a: number, b: number): number;
declare function divide(a: number, b: number): number;
export { add, subtract, multiply, divide };
```

ê·¸ë¦¬ê³  í´ë”ì™€ ì»´íŒŒì¼ëœ ê²°ê³¼ë¬¼ë“¤ì— ë§ì¶°ì„œ `main`, `types` ê·¸ë¦¬ê³  `exports` í•„ë“œë„ ê·¸ì— ë§ê²Œ ë³€ê²½í•´ì£¼ì.
ê¸°ì¡´ì—ëŠ” ê·¸ëƒ¥ `index.js`ë¥¼ `main` í•„ë“œì— ë„£ì–´ì£¼ì—ˆì§€ë§Œ, ì´ì œëŠ” ì»´íŒŒì¼ëœ ê²°ê³¼ë¬¼ì¸ `dist/index.js`ë¥¼ `main` í•„ë“œì— ë„£ì–´ì£¼ì.
ê·¸ë¦¬ê³  ì¶”ê°€ì ìœ¼ë¡œ `exports` í•„ë“œì•ˆì— `types` í•„ë“œë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆë‹¤. ìƒì„±ëœ `d.ts` íŒŒì¼ì„ ëª…ì‹œí•´ì£¼ì.
ê·¸ë¦¬ê³  ë§ˆì§€ë§‰ìœ¼ë¡œ `exports` í•„ë“œì˜ `import`ì—ëŠ” ì»´íŒŒì¼ ê²°ê³¼ë¬¼ì¸ `dist/index.js`ì„ ë„£ì–´ì£¼ì. (`require`ì€ ìš°ì„  ê°€ë§Œíˆ ë†”ë‘¬ë„ ëœë‹¤.)

```json,5-5&12-12&14-14
{
  "name": "junghyeonsu-utils",
  "version": "0.0.3",
  "type": "module",
  "main": "dist/index.js",
  "scripts": {
    "build": "yarn build:tsc",
    "build:tsc": "yarn tsc"
  },
  "exports": {
    ".": {
      "import": "./dist/index.js",
      "require": "./src/index.cjs",
      "types": "./dist/index.d.ts"
    }
  },
  "license": "MIT",
  "devDependencies": {
    "@types/node": "^18.15.0",
    "typescript": "^4.9.5"
  }
}
```

ê·¸ëŸ¼ ë§Œë°˜ì˜ ì¤€ë¹„ëŠ” ëë‚¬ë‹¤. ë‹¤ì‹œ ë°°í¬ë¥¼ í•´ë³´ì!
ìš°ë¦¬ëŠ” `typescript` ì§€ì›ì´ë¼ëŠ” ìƒˆë¡œìš´ ê¸°ëŠ¥ì„ ì¶”ê°€í–ˆê¸° ë•Œë¬¸ì— `minor` ë²„ì „ì„ ì˜¬ë ¤ì£¼ì.

```bash
$ yarn version --minor
$ npm version minor
```

```bash
$ yarn version v1.22.19
$ info Current version: 0.0.1
$ info New version: 0.1.0
$ âœ¨  Done in 0.02s.
```

ê·¸ë¦¬ê³  ë°°í¬í•˜ê¸° ì „ì— `build` ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ê¸° ìœ„í•´ `prepack` ìŠ¤í¬ë¦½íŠ¸ë¥¼ `package.json`ì— ì¶”ê°€í•´ì£¼ì.
`prepack` ìŠ¤í¬ë¦½íŠ¸ëŠ” `npm publish`ë¥¼ ì‹¤í–‰í•˜ê¸° ì „ì— ì‹¤í–‰ë˜ëŠ” ìŠ¤í¬ë¦½íŠ¸ì´ë‹¤.

```json,7-7
{
  "name": "junghyeonsu-utils",
  "version": "0.1.0",
  "type": "module",
  "main": "dist/index.js",
  "scripts": {
    "prepack": "yarn build",
    "build": "yarn build:tsc",
    "build:tsc": "yarn tsc"
  },
  "exports": {
    ".": {
      "import": "./dist/index.js",
      "require": "./src/index.cjs",
      "types": "./dist/index.d.ts"
    }
  },
  "license": "MIT",
  "devDependencies": {
    "@types/node": "^18.15.0",
    "typescript": "^4.9.5"
  }
}
```

ê·¸ë¦¬ê³  `npm publish`ë¥¼ ì‹¤í–‰í•´ë³´ì.

```bash
$ npm publish
```

```bash
$ âœ¨  Done in 2.40s.
$ npm notice
$ npm notice ğŸ“¦  junghyeonsu-utils@0.1.0
$ npm notice === Tarball Contents ===
$ npm notice 266B dist/index.d.ts
$ npm notice 222B dist/index.js
$ npm notice 468B package.json
$ npm notice 236B src/index.cjs
$ npm notice 290B src/index.ts
$ npm notice 710B tsconfig.json
$ npm notice === Tarball Details ===
$ npm notice name:          junghyeonsu-utils
$ npm notice version:       0.1.0
$ npm notice filename:      junghyeonsu-utils-0.1.0
$ npm notice package size:  1.1 kB
$ npm notice unpacked size: 2.2 kB
$ npm notice shasum:        0afd0f07f886608b1cca34c9f4ceeec8cf1beba1
$ npm notice integrity:     sha512-00ha4+oTyEQ0z[...]1SZ7l5cPMaj0w==
$ npm notice total files:   6
$ npm notice
$ npm notice Publishing to https://registry.npmjs.org/
$ + junghyeonsu-utils@0.1.0
```

ì •ìƒì ìœ¼ë¡œ ë°°í¬ê°€ ë˜ì—ˆê³ , í•œ ë²ˆ í…ŒìŠ¤íŠ¸ë¥¼ í•´ë³´ì.
ê¸°ì¡´ì— ë§Œë“¤ì–´ë‘” `test` í”„ë¡œì íŠ¸ë¡œ ë‹¤ì‹œ ëŒì•„ê°€ì„œ minor ë²„ì „ì´ ì˜¬ë¼ê°„ ìš°ë¦¬ì˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë‹¤ì‹œ ì„¤ì¹˜í•´ë³´ì.

```bash
$ yarn add junghyeonsu-utils@0.1.0
```

ê·¸ë¦¬ê³  ë‹¤ì‹œ `test`(vite í”„ë¡œì íŠ¸)ì—ì„œ `import`ë¥¼ í•´ë³´ì.

![íƒ€ì… ì§€ì›ì´ ì˜ëœ ëª¨ìŠµ](./6.png)

## DX(ê°œë°œì ê²½í—˜) í–¥ìƒì‹œí‚¤ê¸°

ì´ì œ ìš°ë¦¬ì˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” `typescript`ë¥¼ ì§€ì›í•˜ê³ , `ESM`ê³¼ `CommonJS`ë¥¼ ëª¨ë‘ ì§€ì›í•˜ê³  ìˆë‹¤.
ê·¸ëŸ°ë° ë¼ì´ë¸ŒëŸ¬ë¦¬ ì½”ë“œë¥¼ ìˆ˜ì •í•  ë•Œ ë§ˆë‹¤ `esm`, `cjs` ë‘˜ ë‹¤ ê³ ì¹ ìˆ˜ëŠ” ì—†ë‹¤.
**íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ ì½”ë“œ í•˜ë‚˜ë¡œ `esm`, `cjs` ë‘˜ ë‹¤ ì»´íŒŒì¼ë˜ê²Œ í•˜ë©´ ì¢‹ì„ ê²ƒ ê°™ë‹¤.**
ë‹¤ì–‘í•œ ë²ˆë“¤ëŸ¬ë“¤ì´ ìˆì§€ë§Œ ìš”ê¸°ì„œëŠ” [esbuild](https://esbuild.github.io/)ë¥¼ ì´ìš©í•´ì„œ `esm`, `cjs` ë‘˜ ë‹¤ ì»´íŒŒì¼í•´ë³´ì.

### esbuild ì„¤ì •

ë‹¤ì‹œ `junghyeonsu-utils` í”„ë¡œì íŠ¸ë¡œ ëŒì•„ì™€ì„œ `esbuild`ë¥¼ ì„¤ì¹˜í•´ë³´ì.

```bash
$ yarn add esbuild -D
```

`esbuild`ëŠ” ì»¤ë§¨ë“œë¼ì¸ì—ì„œë„ ì‚¬ìš©í•  ìˆ˜ ìˆì§€ë§Œ ìŠ¤í¬ë¦½íŠ¸ íŒŒì¼ì„ ì‘ì„±í•´ì„œ ì‚¬ìš©í•  ìˆ˜ë„ ìˆë‹¤.
ë‹¤ì–‘í•œ ì˜µì…˜ë“¤ì„ ì¡°ì •í•˜ê¸° ìœ„í•´ì„œ `build.js` íŒŒì¼ì„ ë§Œë“¤ì–´ì„œ `esbuild`ë¥¼ ì‹¤í–‰í•´ë³´ì.

```js
// build.js
import esbuild from "esbuild";

// ê³µí†µì ìœ¼ë¡œ ì‚¬ìš©í•  ì˜µì…˜ë“¤
const baseConfig = {
  entryPoints: ["src/index.ts"], // ì»´íŒŒì¼í•  íŒŒì¼
  outdir: "dist", // ì»´íŒŒì¼ëœ íŒŒì¼ì´ ì €ì¥ë  ê²½ë¡œ
  bundle: true, // ë²ˆë“¤ë§ ì—¬ë¶€
  sourcemap: true, // ì†ŒìŠ¤ë§µ ìƒì„± ì—¬ë¶€
};

Promise.all([
  // í•œë²ˆì€ cjs
  esbuild.build({
    ...baseConfig,
    format: "cjs",
    outExtension: {
      ".js": ".cjs",
    },
  }),

  // í•œë²ˆì€ esm
  esbuild.build({
    ...baseConfig,
    format: "esm",
  }),
]).catch(() => {
  console.log("Build failed");
  process.exit(1);
});
```

ìœ„ì™€ ê°™ì´ ì‘ì„±í–ˆìœ¼ë©´ `package.json`ì˜ `scripts`ì— `esbuild`ë¡œ ë¹Œë“œí•  ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì¶”ê°€í•´ì£¼ì.
ê·¸ë¦¬ê³  ì¶”ê°€ì ìœ¼ë¡œ ë¹Œë“œí•˜ê¸° ì „ì— `dist` í´ë”ë¥¼ ì‚­ì œí•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸ë„ ì¶”ê°€í•´ì£¼ì.
ë˜í•œ ê¸°ì¡´ `tsc` ëª…ë ¹ì–´ê°€ `js` íŒŒì¼ë„ ìƒì„±í•´ì£¼ëŠ”ë° `esbuild`ë¡œ ìë°”ìŠ¤í¬ë¦½íŠ¸ `cjs`, `esm`ì„ ëª¨ë‘ ìƒì„±í•´ì£¼ë‹ˆ,
ë” ì´ìƒ `tsc`ë¡œëŠ” ìë°”ìŠ¤í¬ë¦½íŠ¸ íŒŒì¼ì„ ìƒì„±í•  í•„ìš”ê°€ ì—†ë‹¤.

> **esbuildë¡œ íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ íƒ€ì…ëª¨ë“ˆ(d.ts)ë„ ìƒì„±í•˜ë©´ ë˜ëŠ” ê²ƒ ì•„ë‹Œê°€ìš”?**
>
> í˜„ì¬ esbuildëŠ” íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ `d.ts` ì»´íŒŒì¼ì„ ì§€ì›í•˜ì§€ ì•ŠëŠ”ë‹¤.
> ê·¸ë˜ì„œ `tsc`ì™€ `esbuild`ë¥¼ ê°™ì´ ì‚¬ìš©í•´ì•¼ í•œë‹¤.

```json,4-7
{
  "scripts": {
    "prepack": "yarn build",
    "build": "yarn clean && yarn build:tsc && yarn build:js",
    "build:tsc": "yarn tsc --emitDeclarationOnly",
    "build:js": "node build.js",
    "clean": "rm -rf dist"
  }
}
```

ì´ë ‡ê²Œ í•˜ê³  ë‚˜ì„œ ë‹¤ì‹œ `yarn build` ëª…ë ¹ì–´ë¡œ ë¹Œë“œë¥¼ í•´ë³´ì.

```bash
yarn run v1.22.19
$ yarn clean && yarn build:tsc && yarn build:js
$ rm -rf dist
$ yarn tsc --emitDeclarationOnly
$ /Users/jeonghyeonsu/Documents/GitHub/junghyeonsu-utils/node_modules/.bin/tsc --emitDeclarationOnly
$ node build.js
âœ¨  Done in 2.76s
```

`dist` í´ë”ì— `cjs`, `esm` ë‘˜ ë‹¤ ìƒì„±ë˜ê³ , `d.ts`ê¹Œì§€ ìƒì„±ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

```bash
ğŸ“¦dist
 â”£ ğŸ“œindex.cjs
 â”£ ğŸ“œindex.cjs.map
 â”£ ğŸ“œindex.d.ts
 â”£ ğŸ“œindex.js
 â”— ğŸ“œindex.js.map
```

ì´ë ‡ê²Œ `build` ëª…ë ¹ì–´ í•œ ë²ˆìœ¼ë¡œ ëª¨ë“  í•„ìš”í•œ íŒŒì¼ë“¤ì´ ìƒì„±ëìœ¼ë‹ˆ `src/index.cjs`ëŠ” í•„ìš”ì—†ìœ¼ë‹ˆ ì‚­ì œë¥¼ í•´ì£¼ì.
ê·¸ë¦¬ê³  ê·¸ì— ë§ê²Œ `exports`ì˜ `require` í•„ë“œë„ `dist` í´ë”ë¥¼ ì°¸ì¡°í•˜ë„ë¡ ìˆ˜ì •í•´ì£¼ì.

ì¶”ê°€ì ìœ¼ë¡œ `package.json`ì— `files` í•„ë“œë¥¼ ì¶”ê°€í•´ì£¼ì.
`files` í•„ë“œëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ì— í¬í•¨ë  íŒŒì¼ ë˜ëŠ” í´ë”ë¥¼ ëª…ì‹œí•´ì£¼ëŠ” í•„ë“œë‹¤.
`build.js` ê°™ì€ ê²½ìš°ì—ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ëŠ” ì…ì¥ì—ì„œëŠ” í•„ìš”ì—†ëŠ” íŒŒì¼ì´ë‹ˆ ì œì™¸ë¥¼ ì‹œí‚¤ê³ ,
ìš°ë¦¬ëŠ” `src` í´ë”ì™€ `dist` í´ë”ë§Œ ë¼ì´ë¸ŒëŸ¬ë¦¬ì— í¬í•¨ì‹œí‚¤ì.
(`src` í´ë”ëŠ” ê°€ë” ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš©ìë“¤ì´ ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ ì†ŒìŠ¤ì½”ë“œë¥¼ ë³´ê³  ì‹¶ì„ ë•Œê°€ ìˆì„ ê²½ìš°ë¥¼ ëŒ€ë¹„í•´ì„œ í¬í•¨ì‹œí‚¨ë‹¤.)

```json,3-3
{
  "exports": {
    "require": "./dist/index.cjs",
    "import": "./dist/index.js",
    "types": "./dist/index.d.ts"
  },
  "files": [
    "dist",
    "src"
  ],
}
```

ì´ë ‡ê²Œ í•˜ë©´ ì •ë§ ëë‚¬ë‹¤.
ë§ˆì§€ë§‰ìœ¼ë¡œ `junghyeonsu-utils`ë¥¼ `major` ë²„ì „ì„ ì˜¬ë ¤ì„œ `1.0.0`ìœ¼ë¡œ ë°°í¬í•´ë³´ì.

```bash
$ npm version major
$ npm publish
```

ê·¸ë¦¬ê³  `test` í”„ë¡œì íŠ¸ì—ì„œ `junghyeonsu-utils`ë¥¼ ì„¤ì¹˜í•´ì„œ
`node_modules`ë¥¼ í™•ì¸í•´ë³´ë©´ `dist` í´ë”ì™€ `src` í´ë” ê·¸ë¦¬ê³  `package.json(default)` ë§Œ í¬í•¨ë˜ì–´ ìˆëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

![junghyeonsu-utilsë¥¼ ì„¤ì¹˜í•˜ê³  node_modulesë¥¼ í™•ì¸](./7.png)

## ë§ˆë¬´ë¦¬

ì´ë ‡ê²Œ `esbuild`ì™€ `tsc`ë¥¼ ì‚¬ìš©í•´ì„œ `cjs`, `esm` ê·¸ë¦¬ê³  íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ê¹Œì§€ ëª¨ë‘ ì§€ì›í•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë§Œë“¤ì—ˆë‹¤.
ì‚¬ì‹¤ ìœ„ì˜ ì–˜ê¸° ë§ê³ ë„ ëª¨ë“  í”„ë¡œì íŠ¸ëŠ” ë°°í¬í•˜ê³  ë‚œ í›„ê°€ ë” ì¤‘ìš”í•˜ë‹¤.

ë²„ì „ ê´€ë¦¬, ë¬¸ì„œí™”, í…ŒìŠ¤íŠ¸, CI/CD ë“±ë“± ë§ì€ ê²ƒë“¤ì´ í•„ìš”í•˜ê³ ,
cli ë¼ì´ë¸ŒëŸ¬ë¦¬, ë¸Œë¼ìš°ì € ë¼ì´ë¸ŒëŸ¬ë¦¬, node ë¼ì´ë¸ŒëŸ¬ë¦¬ ë“±ë“± í™˜ê²½ì´ ë‹¤ì–‘í•˜ë‹¤.

í•´ë‹¹ ê¸€ì´ ë°˜ì‘ì´ ì¢‹ë‹¤ë©´ ë” ë§ì€ ë‚´ìš©ì„ ì¶”ê°€í•´ë³´ë„ë¡ í•˜ê² ë‹¤.
[ê¹ƒí—ˆë¸Œì—ë„ ë¼ì´ë¸ŒëŸ¬ë¦¬](https://github.com/junghyeonsu/utils-library-starter)ë¥¼ ì˜¬ë ¤ë†¨ìœ¼ë‹ˆ ì°¸ê³ í•˜ë©´ ì¢‹ì„ ê²ƒ ê°™ë‹¤.

## ì°¸ê³ 

- [í† ìŠ¤í…Œí¬(ì¥í˜¸ìŠ¹): CommonJSì™€ ESMì— ëª¨ë‘ ëŒ€ì‘í•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ ê°œë°œí•˜ê¸°: exports field](https://toss.tech/article/commonjs-esm-exports-field)
